<!DOCTYPE html>
<html><head>
<script>
if (typeof window.print === 'function' && window.print.toString().indexOf('[native code]') !== -1) { window._native_print = window.print; window.print = function() {}; }
</script>
<link rel="stylesheet" type="text/css" href="qandy.css">
</head><body><p><br>
<div id=txt class="txt"></div>
<div id="pop" class="pop" onMouseOver='PopUpVis="visible";' onMouseOut='PopUpVis=PForce; PUV=setTimeout("document.getElementById(\"pop\").style.visibility=PopUpVis;",100);'></div>
<div id="keyboard-container"></div>

<script>

// 
// Global Variables
//

var devteam=1;  // developer mode
var run="";
var RAM="";           // Current file content in memory
var RAMFILE="";       // Current filename loaded in RAM
var RAMTYPE="";       // Current file type (js, txt, etc)

var screenBuffer = [];
var cursorX = 0;
var cursorY = 0;
var cursorOn=0;
var styleBuffer = [];
var currentStyle = {
  color: 37,      // white foreground
  bgcolor: 40,    // black background
  bold: false,
  inverse: false
};

var txt="";
var mode="txt"; // gfx or txt display
var allowScriptESC=false; // if true, script handles ESC instead of universal termination
var PopX=0;
var PopY=0;
var PopHide="hidden";
var PopAlign="center";
var PForce="hidden";
mapx=7;
var mapy=11;
var map="";

var keyon=1;
var caps=0;  // caps lock state: 0=lowercase, 1=uppercase, 2=extended graphics
var shift=0; // shift key pressed  
var ctrl=0;  // ctrl key pressed
var alt=0;   // alt key pressed
var ctrlPhysical=false;  // track if ctrl was activated by physical keyboard
var altPhysical=false;   // track if alt was activated by physical keyboard
var keyboard=1; // turn keyboard input on/off

var line ="";
var inputStartX=0;
var inputStartY=0;
var cursorPos=0;
var inputScrollPos=0;

var commandHistory = [];  // Array to store command history
var historyIndex = -1;    // Current position in history (-1 = not browsing, typing new command)
var maxHistorySize = 50;  // Maximum number of commands to remember
var tempCommand = "";     // Temporary storage for command being typed when browsing history

var selectionStart = -1;  // Start position of selection (-1 = no selection)
var selectionEnd = -1;    // End position of selection
var selectionBgColor = '#ffffff';   // Selection background color
var selectionFgColor = '#000000';   // Selection text color

var paginationEnabled = true;  // Enable/disable pagination feature
var paginationPaused = false;  // Is print() currently paused?
var paginationBuffer = [];     // Queued text waiting to be printed
var paginationLinesBeforePause = 25;  // Lines to show before pausing
var inInputMode = false;       // True when processing user input (prevents pagination)
</script>

<script>
(function() {
  'use strict';

  // Configuration array with script load order
  var SCRIPT_QUEUE = [
    { src: 'video.js', name: 'Video' },
    { src: 'gfx.js', name: 'Graphics' },
    { src: 'keyboard.js', name: 'Keyboard' },
    { src: 'dos.js', name: 'DOS', optional: true },
    { src: 'qandy.js', name: 'Qandy Core' }
  ];

  var startTime = Date.now();
  var currentIndex = 0;
  var signalAdvance = null;

  // Called by each script when its initialization is complete
  window.qandySignalReady = function(scriptName) {
    console.log('\u2713 ' + scriptName + ' signaled ready');
    if (typeof signalAdvance === 'function') {
      signalAdvance();
    }
  };

  function loadNext() {
    if (currentIndex >= SCRIPT_QUEUE.length) {
      var elapsed = Date.now() - startTime;
      console.log('\u2713 All scripts loaded successfully in ' + elapsed + 'ms');
      document.dispatchEvent(new CustomEvent('qandyReady'));
      return;
    }

    var entry = SCRIPT_QUEUE[currentIndex];
    currentIndex++;

    console.log('Loading: ' + entry.name + ' (' + entry.src + ')');

    var advanced = false;
    function advance() {
      if (advanced) return;
      advanced = true;
      signalAdvance = null;
      loadNext();
    }

    // Register advance as the handler for qandySignalReady for this script
    signalAdvance = advance;

    var script = document.createElement('script');
    script.src = entry.src;

    script.onerror = function() {
      signalAdvance = null;
      if (entry.optional) {
        console.warn('\u26a0 Optional script not found: ' + entry.name);
      } else {
        console.error('\u2717 Failed to load required script: ' + entry.name + ' (' + entry.src + ')');
        alert('Critical error: Failed to load ' + entry.src + '. The application may not work correctly.');
      }
      advance();
    };

    script.onload = function() {
      console.log('\u2713 Loaded: ' + entry.name);
      // If the script already called qandySignalReady, advance() is a no-op here
      advance();
    };

    document.head.appendChild(script);
  }

  // Start loading once the DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadNext);
  } else {
    loadNext();
  }
})();
</script>

</body></html>