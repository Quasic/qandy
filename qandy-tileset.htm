<html><head><title>Qandy Open Source Tileset</title>
<script language="JavaScript"> 

 var mapx=7; var mapy=11; var maps=[]; var sign=[];

 script=document.createElement('script');
 script.src="world.js"; 
 document.head.appendChild(script);

 var VS="A"; var VE="Z"; var Loc=""; var View=""; var Tile=0; var ID=0;
 var DirTile="t"; var DirChar="c"; var DirItem="i";

 mySearch = location.search.substr(1).split("&")
 for (i=0;i<mySearch.length;i++) {
  nameVal = mySearch[i].split("=");
  for (j in nameVal) { nameVal[j] = unescape(nameVal[j]); } 
  if (nameVal[0] == "S") { VS=nameVal[1]; }
  if (nameVal[0] == "E") { VE=nameVal[1]; }
  if (nameVal[0] == "L") { Loc=nameVal[1]; }
  if (nameVal[0] == "V") { View=nameVal[1]; }
  if (nameVal[0] == "T") { Types=nameVal[1]; }
  if (nameVal[0] == "id") { ID=nameVal[1]; }
 }

 LS=-1; for (i=1;i<=255;i++) { if (unescape('%' + i.toString(16)) == VS) { LS=i; }}
 LE=-1; for (i=1;i<=255;i++) { if (unescape('%' + i.toString(16)) == VE) { LE=i; }}
 if(ID=="yes"){document.write('<script language="JavaScript" src="client-itemid.js"></scr'+'ipt>');}
</script>
</head>
<body bgcolor=black text=white link=#9F9FA9 vlink=#6699ff alink=#6699ff>
<p><br><center>
Open Source Tileset
<p>
&nbsp; &nbsp;<a href="?T=T&S=A&E=Z">Tile Set </a> 
&nbsp; &nbsp;<a href="?T=I&S=A&E=Z">Item Codes</a>
&nbsp; &nbsp;<a href="?T=C">Characters</a>
&nbsp; &nbsp;<a href="javascript:DrawMap();">World Map</a>
<p><hr width=800><p>

<script src="qandy-gfx.js"></script>

<script language="JavaScript">
if (Types=="T") {
 for (i=LS;i<LE+1;i++) {
  document.write("<center><table width=600 border=0 bordercolor=navy cellpadding=5><tr>");
  for (j=97;j<113;j++) {
   document.write("<td width=70 align=center><p>");
   document.write("<img src=\"t/"+String.fromCharCode(i,j)+".png\" onerror=\"ImgError(this);\" height=32 width=32>");
   document.write("<br>"+String.fromCharCode(i,j));
   document.write("</td>");
  } 
  document.write("</tr></table>");
 }
}
if (Types=="I") {
 for (i=LS;i<LE+1;i++) {
  document.write("<table width=600 border=0 bordercolor=navy cellpadding=5><tr>");
  for (j=97;j<113;j++) {
   document.write("<td width=70 align=center><p>");
   document.write("<img src=\"i/"+String.fromCharCode(i,j)+".png\" onerror=\"ImgError(this);\" height=32 width=32>");
   document.write("<br>"+String.fromCharCode(i,j)  );
   document.write("</td>");
  }
  document.write("</tr></table>");
 }
}  
if (Types=="C") {
 for (i=LS;i<LE+1;i++) {
  document.write("<table width=600 border=0 bordercolor=navy cellpadding=5><tr>");
  for (j=48;j<58;j++) {
   document.write("<td width=70 align=center><p>");
   document.write("<img src=\"c/"+String.fromCharCode(i,j)+".png\" height=64 width=32 onerror=\"ImgError(this);\" >"+(ID?ItemID(String.fromCharCode(i,j)):''));
   document.write("<br>"+String.fromCharCode(i,j));
   document.write("</td>");
  }
  document.write("</tr></table>");
 }
}

function DrawMap() {
 // Clear the page body and add loading message
 document.body.innerHTML = '<center><div style="color:white; padding: 20px;">Loading world map...</div><div id="mapContainer"></div></center>';
 
 // Create canvas element for efficient rendering
 var canvas = document.createElement('canvas');
 var totalWidth = 26 * mapx * 4; // 26 map sections horizontally × 7 tiles × 4 pixels
 var totalHeight = 10 * mapy * 4; // 10 map sections vertically × 11 tiles × 4 pixels
 canvas.width = totalWidth;
 canvas.height = totalHeight;
 canvas.style.border = '1px solid white';
 var ctx = canvas.getContext('2d');
 
 // Cache for loaded images
 var imageCache = {};
 var imagesToLoad = [];
 var imagesLoaded = 0;
 
 // First pass: collect all unique tile codes
 var uniqueTiles = {};
 for (var y1=65; y1<75; y1++) {
  for (var x1=97; x1<123; x1++) {
   var PMap = String.fromCharCode(y1) + String.fromCharCode(x1);
   if (!maps[PMap]) { 
    maps[PMap] = "UaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUaUa.."; 
   }
   for (var y2=0; y2<mapy; y2++) {
    for (var x2=0; x2<mapx; x2++) {
     var a = maps[PMap].substring(((y2*(mapx+1))+x2)*2, (((y2*(mapx+1))+x2)*2)+2);
     if (a && a !== '..' && !uniqueTiles[a]) {
      uniqueTiles[a] = true;
      imagesToLoad.push(a);
     }
    }
   }
  }
 }
 
 // Update loading message
 document.body.firstChild.firstChild.innerHTML = 'Loading world map (' + imagesToLoad.length + ' unique tiles)...';
 
 // Load all unique images
 var totalImages = imagesToLoad.length;
 if (totalImages === 0) {
  drawAllTiles();
  return;
 }
 
 for (var i = 0; i < imagesToLoad.length; i++) {
  var tileCode = imagesToLoad[i];
  var img = new Image();
  img.onload = function() {
   imagesLoaded++;
   if (imagesLoaded === totalImages) {
    drawAllTiles();
   }
  };
  img.onerror = function() {
   imagesLoaded++;
   if (imagesLoaded === totalImages) {
    drawAllTiles();
   }
  };
  imageCache[tileCode] = img;
  img.src = "m/" + tileCode + ".png";
 }
 
 // Draw all tiles once images are loaded
 function drawAllTiles() {
  for (var y1=65; y1<75; y1++) {
   for (var x1=97; x1<123; x1++) {
    var PMap = String.fromCharCode(y1) + String.fromCharCode(x1);
    var sectionX = (x1 - 97) * mapx * 4;
    var sectionY = (y1 - 65) * mapy * 4;
    
    for (var y2=0; y2<mapy; y2++) {
     for (var x2=0; x2<mapx; x2++) {
      var a = maps[PMap].substring(((y2*(mapx+1))+x2)*2, (((y2*(mapx+1))+x2)*2)+2);
      if (a && a !== '..' && imageCache[a] && imageCache[a].complete) {
       var pixelX = sectionX + (x2 * 4);
       var pixelY = sectionY + (y2 * 4);
       ctx.drawImage(imageCache[a], pixelX, pixelY, 4, 4);
      }
     }
    }
   }
  }
  
  // Add canvas to page
  var container = document.getElementById('mapContainer');
  container.innerHTML = '';
  container.appendChild(canvas);
  
  // Add back button
  var backBtn = document.createElement('div');
  backBtn.innerHTML = '<p><a href="qandy-tileset.htm">Back to Tileset</a></p>';
  container.appendChild(backBtn);
 }
}
function ImgError(e) {
 e.onerror=null; e.src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAaCAYAAABGiCfwAAAACXBIWXMAAAsSAAALEgHS3X78AAAAKElEQVRIie3NMQEAAAgDILV/51nBywsK0Enqy7xNMplMJpPJZDLZ0QI7tAMxEF7bywAAAABJRU5ErkJggg=='; 
}  

</script></center></b></font>
<p><br><br><br><br></body></html>
