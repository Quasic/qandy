<!DOCTYPE html>
<html><head>
<meta charset="UTF-8">
<title>DOS Error Handling Test</title>
<style>
body {
  background-color: #000;
  color: #0f0;
  font-family: 'Courier New', monospace;
  padding: 20px;
}
h1 {
  color: #0f0;
  text-align: center;
  border-bottom: 2px solid #0f0;
  padding-bottom: 10px;
}
.test-section {
  margin: 20px 0;
  padding: 15px;
  border: 1px solid #0f0;
  background-color: #001100;
}
.test-title {
  color: #ff0;
  font-weight: bold;
  margin-bottom: 10px;
}
.success {
  color: #0f0;
}
.error {
  color: #f00;
}
button {
  background-color: #003300;
  color: #0f0;
  border: 1px solid #0f0;
  padding: 8px 16px;
  margin: 5px;
  cursor: pointer;
  font-family: 'Courier New', monospace;
}
button:hover {
  background-color: #005500;
}
#output {
  white-space: pre-wrap;
  font-family: 'Courier New', monospace;
  background-color: #000;
  padding: 10px;
  border: 1px solid #0f0;
  min-height: 300px;
  max-height: 600px;
  overflow-y: auto;
}
code {
  background-color: #002200;
  padding: 2px 5px;
  color: #0ff;
}
</style>
</head>
<body>

<h1>DOS ERROR HANDLING TEST</h1>
<p style="text-align: center; color: #ff0;">New simplified error handling: Check if result.substring(0,5) === "ERROR"</p>

<div class="test-section">
  <div class="test-title">Test Suite</div>
  <button onclick="runAllTests()">RUN ALL TESTS</button>
  <button onclick="clearOutput()">CLEAR OUTPUT</button>
</div>

<div class="test-section">
  <div class="test-title">Console Output</div>
  <div id="output"></div>
</div>

<script src="dos.js"></script>
<script>
function log(message, isError) {
  const output = document.getElementById('output');
  const color = isError ? 'error' : 'success';
  output.innerHTML += '<span class="' + color + '">' + escapeHtml(message) + '</span>\n';
  output.scrollTop = output.scrollHeight;
}

function escapeHtml(text) {
  const map = {'&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;'};
  return text.replace(/[&<>"']/g, m => map[m]);
}

function clearOutput() {
  document.getElementById('output').innerHTML = '';
}

function runAllTests() {
  clearOutput();
  log('═══════════════════════════════════════', false);
  log('  DOS ERROR HANDLING TEST SUITE', false);
  log('═══════════════════════════════════════\n', false);
  
  testSaveSuccess();
  testSaveErrors();
  testLoadSuccess();
  testLoadErrors();
  testDelSuccess();
  testDelErrors();
  
  log('\n═══════════════════════════════════════', false);
  log('  ALL TESTS COMPLETED', false);
  log('═══════════════════════════════════════\n', false);
}

function testSaveSuccess() {
  log('[TEST] save() - Success case', false);
  log('───────────────────────────────────────', false);
  
  var result = save("test-success.txt", "Hello, World!");
  log('save("test-success.txt", "Hello, World!")', false);
  log('Result: ' + result, false);
  
  if (result.substring(0, 5) === "ERROR") {
    log('✗ FAIL: Expected success, got error', true);
  } else if (result === "OK") {
    log('✓ PASS: Returned "OK"', false);
  } else {
    log('✗ FAIL: Unexpected return value: ' + result, true);
  }
  log('', false);
}

function testSaveErrors() {
  log('[TEST] save() - Error cases', false);
  log('───────────────────────────────────────', false);
  
  // Test 1: Empty filename
  var result = save("", "data");
  log('Test 1: save("", "data")', false);
  log('Result: ' + result, false);
  if (result.substring(0, 5) === "ERROR") {
    log('✓ PASS: Error detected correctly', false);
  } else {
    log('✗ FAIL: Should return ERROR', true);
  }
  log('', false);
  
  // Test 2: Non-string data
  var result = save("test.txt", 123);
  log('Test 2: save("test.txt", 123)', false);
  log('Result: ' + result, false);
  if (result.substring(0, 5) === "ERROR") {
    log('✓ PASS: Error detected correctly', false);
  } else {
    log('✗ FAIL: Should return ERROR', true);
  }
  log('', false);
}

function testLoadSuccess() {
  log('[TEST] load() - Success case', false);
  log('───────────────────────────────────────', false);
  
  // First save a file
  save("test-load.txt", "Test content");
  
  var result = load("test-load.txt");
  log('load("test-load.txt")', false);
  log('Result: ' + result, false);
  
  if (result.substring(0, 5) === "ERROR") {
    log('✗ FAIL: Expected success, got error: ' + result, true);
  } else if (result === "Test content") {
    log('✓ PASS: Loaded correct content', false);
  } else {
    log('✗ FAIL: Unexpected content: ' + result, true);
  }
  log('', false);
}

function testLoadErrors() {
  log('[TEST] load() - Error cases', false);
  log('───────────────────────────────────────', false);
  
  // Test 1: Non-existent file
  var result = load("nonexistent.txt");
  log('Test 1: load("nonexistent.txt")', false);
  log('Result: ' + result, false);
  if (result.substring(0, 5) === "ERROR") {
    log('✓ PASS: Error detected correctly', false);
    log('Error message: ' + result, false);
  } else {
    log('✗ FAIL: Should return ERROR', true);
  }
  log('', false);
  
  // Test 2: Empty filename
  var result = load("");
  log('Test 2: load("")', false);
  log('Result: ' + result, false);
  if (result.substring(0, 5) === "ERROR") {
    log('✓ PASS: Error detected correctly', false);
  } else {
    log('✗ FAIL: Should return ERROR', true);
  }
  log('', false);
}

function testDelSuccess() {
  log('[TEST] del() - Success case', false);
  log('───────────────────────────────────────', false);
  
  // First save a file
  save("test-delete.txt", "To be deleted");
  
  var result = del("test-delete.txt");
  log('del("test-delete.txt")', false);
  log('Result: ' + result, false);
  
  if (result.substring(0, 5) === "ERROR") {
    log('✗ FAIL: Expected success, got error: ' + result, true);
  } else if (result === "OK") {
    log('✓ PASS: Returned "OK"', false);
    
    // Verify file is deleted
    var loadResult = load("test-delete.txt");
    if (loadResult.substring(0, 5) === "ERROR") {
      log('✓ PASS: File confirmed deleted', false);
    } else {
      log('✗ FAIL: File still exists', true);
    }
  } else {
    log('✗ FAIL: Unexpected return value: ' + result, true);
  }
  log('', false);
}

function testDelErrors() {
  log('[TEST] del() - Error cases', false);
  log('───────────────────────────────────────', false);
  
  // Test 1: Non-existent file
  var result = del("nonexistent.txt");
  log('Test 1: del("nonexistent.txt")', false);
  log('Result: ' + result, false);
  if (result.substring(0, 5) === "ERROR") {
    log('✓ PASS: Error detected correctly', false);
    log('Error message: ' + result, false);
  } else {
    log('✗ FAIL: Should return ERROR', true);
  }
  log('', false);
  
  // Test 2: Empty filename
  var result = del("");
  log('Test 2: del("")', false);
  log('Result: ' + result, false);
  if (result.substring(0, 5) === "ERROR") {
    log('✓ PASS: Error detected correctly', false);
  } else {
    log('✗ FAIL: Should return ERROR', true);
  }
  log('', false);
}

// Auto-run on load
window.onload = function() {
  log('DOS API loaded and ready for testing\n', false);
  log('Click "RUN ALL TESTS" to start\n', false);
};
</script>

</body>
</html>
