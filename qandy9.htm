<!DOCTYPE html>
<html><head>
<script>
if (typeof window.print === 'function' && window.print.toString().indexOf('[native code]') !== -1) { window._native_print = window.print; window.print = function() {}; }
</script>
<link rel="stylesheet" type="text/css" href="qandy.css">
</head><body><p><br>
<div id=txt class="txt"></div>
<div id="pop" class="pop" onMouseOver='PopUpVis="visible";' onMouseOut='PopUpVis=PForce; PUV=setTimeout("document.getElementById(\"pop\").style.visibility=PopUpVis;",100);'></div>
<div id="keyboard-container"></div>

<script>
// Define Global Variables

var devteam=1;  // developer mode
var run="";

// video.js
var screenBuffer = [];
var cursorX = 0;
var cursorY = 0;
var cursorOn=0;
var styleBuffer = [];
var currentStyle = {
  color: 37,      // white foreground
  bgcolor: 40,    // black background
  bold: false,
  inverse: false
};

var txt="";
var mode="txt"; // gfx or txt display
var allowScriptESC=false; // if true, script handles ESC instead of universal termination
var PopX=0;
var PopY=0;
var PopHide="hidden";
var PopAlign="center";
var PForce="hidden";
var mapx=7;
var mapy=11;
var map="";

// keyboard.js
var keyon=1;
var caps=0;  // caps lock state: 0=lowercase, 1=uppercase, 2=extended graphics
var shift=0; // shift key pressed  
var ctrl=0;  // ctrl key pressed
var alt=0;   // alt key pressed
var ctrlPhysical=false;  // track if ctrl was activated by physical keyboard
var altPhysical=false;   // track if alt was activated by physical keyboard
var keyboard=1; // turn keyboard input on/off

var line ="";
var inputStartX=0;
var inputStartY=0;
var cursorPos=0;
var inputScrollPos=0;

var commandHistory = [];  // Array to store command history
var historyIndex = -1;    // Current position in history (-1 = not browsing, typing new command)
var maxHistorySize = 50;  // Maximum number of commands to remember
var tempCommand = "";     // Temporary storage for command being typed when browsing history

var selectionStart = -1;  // Start position of selection (-1 = no selection)
var selectionEnd = -1;    // End position of selection
var selectionBgColor = '#ffffff';   // Selection background color
var selectionFgColor = '#000000';   // Selection text color

var normalKeys = {
  "1":"1","2":"2","3":"3","4":"4","5":"5",
  "6":"6","7":"7","8":"8","9":"9","0":"0",
  "q":"q","w":"w","e":"e","r":"r","t":"t",
  "y":"y","u":"u","i":"i","o":"o","p":"p",
  "a":"a","s":"s","d":"d","f":"f","g":"g",
  "h":"h","j":"j","k":"k","l":"l",
  "z":"z","x":"x","c":"c","v":"v","b":"b",
  "n":"n","m":"m",
  "[":"[", "]":"]", ";":";", "'":"'",
  ",":",", ".":".", "/":"/", "=":"=", "-":"-",
  "\\":"\\", "`":"`"
};

var shiftedKeys = {
  "1":"!","2":"@","3":"#","4":"$","5":"%",
  "6":"^","7":"&","8":"*","9":"(","0":")",
  "q":"Q","w":"W","e":"E","r":"R","t":"T",
  "y":"Y","u":"U","i":"I","o":"O","p":"P",
  "a":"A","s":"S","d":"D","f":"F","g":"G",
  "h":"H","j":"J","k":"K","l":"L",
  "z":"Z","x":"X","c":"C","v":"V","b":"B",
  "n":"N","m":"M",
  "[":"{", "]":"}", ";":":", "'":"\"",
  ",":"<", ".":">", "/":"?", "=":"+", "-":"_",
  "\\":"|", "`":"~"
};

var altKeys = {
  "q":"┌","w":"─","e":"┐","r":"├","t":"┤",
  "y":"└","u":"┴","i":"┘","o":"│","p":"┼",
  "a":"╔","s":"═","d":"╗","f":"╠","g":"╣",
  "h":"╚","j":"╩","k":"╝","l":"║",";":"╬",
  "z":"▀","x":"▄","c":"█","v":"▌","b":"▐",
  "n":"░","m":"▒",",":"▓",".":"■","/":"□",
  "1":"☺","2":"☻","3":"♥","4":"♦","5":"♣",
  "6":"♠","7":"•","8":"◘","9":"○","0":"◙",
  "[":"«", "]":"»", "-":"─", "=":"═",
  "\\":" ","`":"°", "'":"″"
};

var altShiftKeys = {
  "q":"╭","w":"╌","e":"╮","r":"╞","t":"╡",
  "y":"╰","u":"╴","i":"╯","o":"╎","p":"╪",
  "a":"┏","s":"━","d":"┓","f":"┣","g":"┫",
  "h":"┗","j":"┻","k":"┛","l":"┃",";":"╋",
  "z":"▔","x":"▁","c":"▪","v":"▸","b":"◂",
  "n":"▴","m":"▾",",":"◊",".":"●","/":"○",
  "1":"↑","2":"↓","3":"←","4":"→","5":"↔",
  "6":"↕","7":"★","8":"☆","9":"◆","0":"◇",
  "[":"‹", "]":"›", "-":"―", "=":"≡",
  "\\":" ","`":"¬", "'":"′"
};

var keyboardData = [
  // Row 0: ESC, BACKTICK, BACKSLASH, OPEN, CLOSE, DASH, EQUAL, BACK (y=446)
  {id:"esc", label:"ESC", keyCode:27, x:47, y:446, width:52},
  {id:"backtick", label:"`", keyCode:192, x:103, y:446, width:28},
  {id:"backslash", label:"\\", keyCode:220, x:132, y:446, width:28},
  {id:"open", label:"[", keyCode:219, x:160, y:446, width:28},
  {id:"close", label:"]", keyCode:221, x:189, y:446, width:28},
  {id:"dash", label:"-", keyCode:173, x:218, y:446, width:28},
  {id:"equal", label:"=", keyCode:61, x:247, y:446, width:28},
  {id:"back", label:"BACK", keyCode:8, x:275, y:446, width:52},
  // Row 1: Number keys 1-0 (y=480)
  {id:"n1", label:"1", keyCode:49, x:47, y:480, width:28},
  {id:"n2", label:"2", keyCode:50, x:75, y:480, width:28},
  {id:"n3", label:"3", keyCode:51, x:103, y:480, width:28},
  {id:"n4", label:"4", keyCode:52, x:132, y:480, width:28},
  {id:"n5", label:"5", keyCode:53, x:160, y:480, width:28},
  {id:"n6", label:"6", keyCode:54, x:189, y:480, width:28},
  {id:"n7", label:"7", keyCode:55, x:218, y:480, width:28},
  {id:"n8", label:"8", keyCode:56, x:247, y:480, width:28},
  {id:"n9", label:"9", keyCode:57, x:275, y:480, width:28},
  {id:"n0", label:"0", keyCode:48, x:303, y:480, width:28},
  // Row 2: QWERTY (y=511)
  {id:"q", label:"q", keyCode:81, x:47, y:511, width:28},
  {id:"w", label:"w", keyCode:87, x:75, y:511, width:28},
  {id:"e", label:"e", keyCode:69, x:103, y:511, width:28},
  {id:"r", label:"r", keyCode:82, x:132, y:511, width:28},
  {id:"t", label:"t", keyCode:84, x:160, y:511, width:28},
  {id:"y", label:"y", keyCode:89, x:189, y:511, width:28},
  {id:"u", label:"u", keyCode:85, x:218, y:511, width:28},
  {id:"i", label:"i", keyCode:73, x:247, y:511, width:28},
  {id:"o", label:"o", keyCode:79, x:275, y:511, width:28},
  {id:"p", label:"p", keyCode:80, x:303, y:511, width:28},
  // Row 3: ASDF (y=542)
  {id:"a", label:"a", keyCode:65, x:47, y:542, width:28},
  {id:"s", label:"s", keyCode:83, x:75, y:542, width:28},
  {id:"d", label:"d", keyCode:68, x:103, y:542, width:28},
  {id:"f", label:"f", keyCode:70, x:132, y:542, width:28},
  {id:"g", label:"g", keyCode:71, x:160, y:542, width:28},
  {id:"h", label:"h", keyCode:72, x:189, y:542, width:28},
  {id:"j", label:"j", keyCode:74, x:218, y:542, width:28},
  {id:"k", label:"k", keyCode:75, x:247, y:542, width:28},
  {id:"l", label:"l", keyCode:76, x:275, y:542, width:28},
  {id:"quote", label:"'", keyCode:222, x:303, y:542, width:28},
  // Row 4: ZXCV (y=573)
  {id:"z", label:"z", keyCode:90, x:47, y:573, width:28},
  {id:"x", label:"x", keyCode:88, x:75, y:573, width:28},
  {id:"c", label:"c", keyCode:67, x:103, y:573, width:28},
  {id:"v", label:"v", keyCode:86, x:132, y:573, width:28},
  {id:"b", label:"b", keyCode:66, x:160, y:573, width:28},
  {id:"n", label:"n", keyCode:78, x:189, y:573, width:28},
  {id:"m", label:"m", keyCode:77, x:218, y:573, width:28},
  {id:"colon", label:";", keyCode:59, x:247, y:573, width:28},
  {id:"enter", label:"ENTER", keyCode:13, x:275, y:573, width:52},

  // Row 5: Bottom row with modifiers (y=604)
  {id:"caps", label:"CAPS", keyCode:20, x:47, y:604, width:52},
  {id:"space", label:"SPACE", keyCode:32, x:103, y:604, width:81},
  {id:"ctrl", label:"CTRL", keyCode:17, x:189, y:604, width:28},
  {id:"alt", label:"ALT", keyCode:18, x:218, y:604, width:28},
  {id:"comma", label:",", keyCode:188, x:247, y:604, width:28},
  {id:"dot", label:".", keyCode:190, x:275, y:604, width:28},
  {id:"slash", label:"/", keyCode:191, x:303, y:604, width:28}
];

// dos.js
var device = "local";
var RAM="";           // Current file content in memory
var RAMFILE="";       // Current filename loaded in RAM
var RAMTYPE="";       // Current file type (js, txt, etc)

// stray code
var paginationEnabled = true;  // Enable/disable pagination feature
var paginationPaused = false;  // Is print() currently paused?
var paginationBuffer = [];     // Queued text waiting to be printed
var paginationLinesBeforePause = 25;  // Lines to show before pausing
var inInputMode = false;       // True when processing user input (prevents pagination)
</script>

<script>
(function() {
  'use strict';

  // Configuration array with script load order
  var SCRIPT_QUEUE = [
    { src: 'video.js', name: 'Video' },
    { src: 'gfx.js', name: 'Graphics' },
    { src: 'keyboard.js', name: 'Keyboard' },
    { src: 'dos.js', name: 'DOS', optional: true },
    { src: 'qandy.js', name: 'Qandy Core' }
  ];

  var startTime = Date.now();
  var currentIndex = 0;
  var signalAdvance = null;

  // Called by each script when its initialization is complete
  window.qandySignalReady = function(scriptName) {
    console.log('\u2713 ' + scriptName + ' signaled ready');
    if (typeof signalAdvance === 'function') {
      signalAdvance();
    }
  };

  function loadNext() {
    if (currentIndex >= SCRIPT_QUEUE.length) {
      var elapsed = Date.now() - startTime;
      console.log('\u2713 All scripts loaded successfully in ' + elapsed + 'ms');
      document.dispatchEvent(new CustomEvent('qandyReady'));
      return;
    }

    var entry = SCRIPT_QUEUE[currentIndex];
    currentIndex++;

    console.log('Loading: ' + entry.name + ' (' + entry.src + ')');

    var advanced = false;
    function advance() {
      if (advanced) return;
      advanced = true;
      signalAdvance = null;
      loadNext();
    }

    // Register advance as the handler for qandySignalReady for this script
    signalAdvance = advance;

    var script = document.createElement('script');
    script.src = entry.src;

    script.onerror = function() {
      signalAdvance = null;
      if (entry.optional) {
        console.warn('\u26a0 Optional script not found: ' + entry.name);
      } else {
        console.error('\u2717 Failed to load required script: ' + entry.name + ' (' + entry.src + ')');
        alert('Critical error: Failed to load ' + entry.src + '. The application may not work correctly.');
      }
      advance();
    };

    script.onload = function() {
      console.log('\u2713 Loaded: ' + entry.name);
      // If the script already called qandySignalReady, advance() is a no-op here
      advance();
    };

    document.head.appendChild(script);
  }

  // Start loading once the DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadNext);
  } else {
    loadNext();
  }
})();
</script>

</body></html>